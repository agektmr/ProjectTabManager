<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../ptm-favicon/ptm-favicon.html">

<!--
entry {
  id         : bookmark id if bookmarked
  tabId      : tabId of the page if open
  title      : title of the page
  url        : url of the bookmark
  pinned     : pinned flag
  favIconUrl : favicon Url
}
-->
<dom-module id="ptm-bookmark">
  <style>
  paper-item > *:not(:first-child):not(:last-child) {
    margin-right: 0 !important;
  }
  .title {
    cursor: pointer;
    color: #aaa;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
  }
  .title[active] {
    color: black;
  }
  #star {
    color: #D3D3D3;
  }
  #star[bookmarked] {
    color: #FAC12F;
  }
  </style>
  <template>
    <paper-item class="layout">
      <ptm-favicon id="favicon" url="[[url]]" fav-icon-url="{{favIconUrl}}"></ptm-favicon>
      <div class="title flex" on-tap="open" active$="[[_isActive(tabId)]]">
        <!-- <paper-ripple recenters></paper-ripple> -->
        <span>[[title]]</span>
      </div>
      <template is="dom-if" if="[[projectLinked]]">
        <paper-icon-button id="star" icon="icons:star" on-tap="_onTapStar" bookmarked$="[[_isBookmarked(bookmarkId)]]"></paper-icon-button>
      </template>
    </paper-item>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'ptm-bookmark',
    properties: {
      url: {
        type: String,
        value: '',
        reflectToAttribute: true
      },
      favIconUrl: {
        type: String,
        value: '',
        reflectToAttribute: true
      },
      projectLinked: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },
      title: {
        type: String,
        value: '',
        reflectToAttribute: true
      },
      tabId: {
        type: Number,
        value: undefined,
        reflectToAttribute: true
      },
      bookmarkId: {
        type: String,
        value: '',
        reflectToAttribute: true
      }
    },
    open: function(e) {
      e.stopPropagation();
      var that = this;
      // If tab id is not assigned
      if (!this.tabId) {
        // Open new project entry
        chrome.tabs.create({url: this.url, active: true});
      } else {
        chrome.tabs.get(this.tabId, function(tab) {
          // If the project filed is not open yet
          if (!tab) {
            // Open new project entry
            chrome.tabs.create({url: that.url, active: true});
          // If the project filed is already open
          } else {
            chrome.windows.get(tab.windowId, function(win) {
              if (!win.focused) {
                // Move focus to the window
                chrome.windows.update(tab.windowId, {focused:true});
              }
              // Activate open project entry
              chrome.tabs.update(that.tabId, {active: true});
            });
          }
        });
      }
    },
    _isActive: function(tabId) {
      return tabId !== undefined;
    },
    _isBookmarked: function(bookmarkId) {
      return bookmarkId !== '';
    },
    _onTapStar: function(e) {
      e.stopPropagation();
      this.fire('toggle-bookmark');
    }
  })
</script>
